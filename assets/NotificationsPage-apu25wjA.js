import{u as e,n as a,j as t,a as s,N as r}from"./index-7VfhOhEA.js";import{u as i,r as o}from"./router-BlRKbG7o.js";import{y as l,aG as n}from"./icons-FsuYV2CB.js";import"./react-vendor-Dp0kJvEn.js";import"./lottie-BmTBBIiw.js";import"./chess-Bi0BiJQc.js";const d=({notification:l,onActionTaken:n})=>{const d=i(),{users:c,acceptRequest:m,rejectRequest:x,followUser:u,unfollowUser:g,isFollowing:h}=e(),[f,y]=o.useState(!1),[b,w]=o.useState(null);o.useEffect(()=>{(async()=>{if(l.actorId&&!c[l.actorId])try{const e=await s.getUser(l.actorId);e.success&&w(e.user)}catch(e){}else w(c[l.actorId])})()},[l.actorId,c]);const k=b;if(!k)return null;const p=(()=>{var e;switch(l.type){case r.FOLLOW_REQUEST:return{icon:"ðŸ‘¤",message:"requested to follow you",action:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:async()=>{y(!0);try{await a.markAsRead(l.id),await m(l.actorId),null==n||n()}finally{y(!1)}},disabled:f,className:"px-4 py-1.5 bg-wa-teal text-white rounded-lg text-sm font-medium hover:bg-wa-tealDark disabled:opacity-50",children:"Accept"}),t.jsx("button",{onClick:async()=>{y(!0);try{await a.markAsRead(l.id),await x(l.actorId),null==n||n()}finally{y(!1)}},disabled:f,className:"px-4 py-1.5 bg-gray-200 dark:bg-wa-dark-hover text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-300 dark:hover:bg-wa-dark-border disabled:opacity-50",children:"Reject"})]})};case r.FOLLOW_ACCEPTED:return{icon:"âœ…",message:"accepted your follow request",action:t.jsx("button",{onClick:async()=>{await a.markAsRead(l.id),d(`/profile/${k.id}`)},className:"px-4 py-1.5 bg-gray-200 dark:bg-wa-dark-hover text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-300 dark:hover:bg-wa-dark-border",children:"View Profile"})};case r.NEW_FOLLOWER:return{icon:"ðŸ‘¥",message:"started following you",action:h(k.id)?t.jsx("button",{onClick:async()=>{y(!0);try{await a.markAsRead(l.id),await g(k.id),null==n||n()}finally{y(!1)}},disabled:f,className:"px-4 py-1.5 bg-gray-200 dark:bg-wa-dark-hover text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-300 dark:hover:bg-wa-dark-border disabled:opacity-50",children:"Following"}):t.jsx("button",{onClick:async()=>{y(!0);try{await a.markAsRead(l.id),await u(k.id),null==n||n()}finally{y(!1)}},disabled:f,className:"px-4 py-1.5 bg-wa-teal text-white rounded-lg text-sm font-medium hover:bg-wa-tealDark disabled:opacity-50",children:"Follow Back"})};case r.FOLLOW_BACK:return{icon:"ðŸ”„",message:"followed you back",action:t.jsx("button",{onClick:async()=>{await a.markAsRead(l.id),d(`/chat/${k.id}`)},className:"px-4 py-1.5 bg-wa-teal text-white rounded-lg text-sm font-medium hover:bg-wa-tealDark",children:"Message"})};case r.ADDED_TO_GROUP:return{icon:"ðŸ‘¥",message:`added you to the group "${(null==(e=l.metadata)?void 0:e.groupName)||"a group"}"`,action:t.jsx("button",{onClick:async()=>{var e;await a.markAsRead(l.id),d(`/chat/${null==(e=l.metadata)?void 0:e.groupId}`)},className:"px-4 py-1.5 bg-wa-teal text-white rounded-lg text-sm font-medium hover:bg-wa-tealDark",children:"View Group"})};default:return{icon:"ðŸ“¬",message:"",action:null}}})(),j=function(e){if(!e)return"";const a=new Date,t=e.toDate?e.toDate():new Date(e),s=Math.floor((a-t)/1e3);return s<60?"Just now":s<3600?`${Math.floor(s/60)}m ago`:s<86400?`${Math.floor(s/3600)}h ago`:s<604800?`${Math.floor(s/86400)}d ago`:`${Math.floor(s/604800)}w ago`}(l.createdAt);return t.jsxs("div",{className:"flex items-start gap-3 p-4 hover:bg-gray-50 dark:hover:bg-wa-dark-hover transition-colors cursor-pointer "+(l.read?"":"bg-blue-50 dark:bg-blue-900/10"),onClick:async()=>{await a.markAsRead(l.id),d(`/profile/${k.id}`)},children:[t.jsx("img",{src:k.avatar||`https://ui-avatars.com/api/?name=${k.name}&background=128c7e&color=fff`,alt:k.name,className:"w-12 h-12 rounded-full object-cover shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:[t.jsx("span",{className:"font-semibold",children:k.name})," ",t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:p.message})]}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:j})]}),t.jsx("span",{className:"text-lg shrink-0",children:p.icon})]}),p.action&&t.jsx("div",{className:"mt-3",onClick:e=>e.stopPropagation(),children:p.action})]}),!l.read&&t.jsx("div",{className:"w-2 h-2 bg-wa-teal rounded-full shrink-0 mt-2"})]})},c=()=>{const s=i(),{currentUser:r}=e(),[c,m]=o.useState([]),[x,u]=o.useState(!0),[g,h]=o.useState(0),[f,y]=o.useState(0);o.useEffect(()=>{b();const e=setTimeout(()=>{(null==r?void 0:r.id)&&a.markAllAsRead(r.id).catch(e=>{})},1500);return()=>{clearTimeout(e)}},[null==r?void 0:r.id]);const b=async()=>{if(null==r?void 0:r.id){u(!0);try{const e=await a.getUserNotifications(r.id,50);e.success&&(m(e.notifications),h(e.unreadCount),y(e.notifications.length))}catch(e){}finally{u(!1)}}},w=()=>{b()};return t.jsxs("div",{className:"flex flex-col pb-20 bg-white dark:bg-wa-dark-bg min-h-full",children:[t.jsxs("div",{className:"hidden md:flex h-[60px] bg-wa-grayBg dark:bg-wa-dark-header items-center gap-3 px-4 shrink-0 border-b border-wa-border dark:border-wa-dark-border text-[#111b21] dark:text-gray-100 transition-colors sticky top-0 z-10",children:[t.jsx("button",{onClick:()=>s(-1),className:"p-2 -ml-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors",children:t.jsx(l,{size:24})}),t.jsx("h2",{className:"text-xl font-medium md:text-lg",children:"Notifications"}),f>0&&t.jsxs("span",{className:"ml-auto text-sm bg-wa-teal/10 text-wa-teal px-2 py-1 rounded-full",children:[f," ",1===f?"notification":"notifications"]})]}),t.jsxs("div",{className:"flex md:hidden items-center justify-between px-4 py-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:()=>s(-1),className:"p-2 -ml-2 hover:bg-gray-100 dark:hover:bg-wa-dark-hover rounded-full transition-colors",children:t.jsx(l,{size:24,className:"text-[#111b21] dark:text-gray-100"})}),t.jsx("h1",{className:"text-xl font-medium text-[#111b21] dark:text-gray-100",children:"Notifications"})]}),f>0&&t.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[f," ",1===f?"notification":"notifications"]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"max-w-3xl mx-auto",children:x?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"w-12 h-12 border-4 border-wa-teal border-t-transparent rounded-full animate-spin"})}):0===c.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center px-4",children:[t.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-wa-dark-hover rounded-full flex items-center justify-center mb-4",children:t.jsx(n,{size:40,className:"text-gray-400"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"No notifications yet"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-sm",children:"When someone follows you or requests to follow, you'll see it here"})]}):t.jsx("div",{className:"divide-y divide-gray-200 dark:divide-wa-dark-border",children:c.map(e=>t.jsx(d,{notification:e,onActionTaken:w},e.id))})})})]})};export{c as default};
