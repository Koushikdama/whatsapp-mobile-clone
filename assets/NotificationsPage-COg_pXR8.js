import{u as e,n as a,j as t,a as r,N as s}from"./index-BvqpNl34.js";import{u as o,r as l}from"./router-BlRKbG7o.js";import{y as i,aA as n}from"./icons-DchmmGMJ.js";import"./react-vendor-Dp0kJvEn.js";import"./lottie-BmTBBIiw.js";import"./chess-Bi0BiJQc.js";const d=({notification:a,onActionTaken:i})=>{const n=o(),{users:d,acceptRequest:c,rejectRequest:m,followUser:x,unfollowUser:u,isFollowing:g}=e(),[h,f]=l.useState(!1),[b,y]=l.useState(null);l.useEffect(()=>{(async()=>{if(a.actorId&&!d[a.actorId])try{const e=await r.getUser(a.actorId);e.success&&y(e.user)}catch(e){}else y(d[a.actorId])})()},[a.actorId,d]);const p=b;if(!p)return null;const w=(()=>{var e;switch(a.type){case s.FOLLOW_REQUEST:return{icon:"ðŸ‘¤",message:"requested to follow you",action:t.jsxs("div",{className:"flex gap-2",children:[t.jsx("button",{onClick:async()=>{f(!0);try{await c(a.actorId),null==i||i()}finally{f(!1)}},disabled:h,className:"px-4 py-1.5 bg-wa-teal text-white rounded-lg text-sm font-medium hover:bg-wa-tealDark disabled:opacity-50",children:"Accept"}),t.jsx("button",{onClick:async()=>{f(!0);try{await m(a.actorId),null==i||i()}finally{f(!1)}},disabled:h,className:"px-4 py-1.5 bg-gray-200 dark:bg-wa-dark-hover text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-300 dark:hover:bg-wa-dark-border disabled:opacity-50",children:"Reject"})]})};case s.FOLLOW_ACCEPTED:return{icon:"âœ…",message:"accepted your follow request",action:t.jsx("button",{onClick:()=>n(`/profile/${p.id}`),className:"px-4 py-1.5 bg-gray-200 dark:bg-wa-dark-hover text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-300 dark:hover:bg-wa-dark-border",children:"View Profile"})};case s.NEW_FOLLOWER:return{icon:"ðŸ‘¥",message:"started following you",action:g(p.id)?t.jsx("button",{onClick:async()=>{f(!0);try{await u(p.id),null==i||i()}finally{f(!1)}},disabled:h,className:"px-4 py-1.5 bg-gray-200 dark:bg-wa-dark-hover text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-300 dark:hover:bg-wa-dark-border disabled:opacity-50",children:"Following"}):t.jsx("button",{onClick:async()=>{f(!0);try{await x(p.id),null==i||i()}finally{f(!1)}},disabled:h,className:"px-4 py-1.5 bg-wa-teal text-white rounded-lg text-sm font-medium hover:bg-wa-tealDark disabled:opacity-50",children:"Follow Back"})};case s.FOLLOW_BACK:return{icon:"ðŸ”„",message:"followed you back",action:t.jsx("button",{onClick:()=>n(`/chat/${p.id}`),className:"px-4 py-1.5 bg-wa-teal text-white rounded-lg text-sm font-medium hover:bg-wa-tealDark",children:"Message"})};case s.ADDED_TO_GROUP:return{icon:"ðŸ‘¥",message:`added you to the group "${(null==(e=a.metadata)?void 0:e.groupName)||"a group"}"`,action:t.jsx("button",{onClick:()=>{var e;return n(`/chat/${null==(e=a.metadata)?void 0:e.groupId}`)},className:"px-4 py-1.5 bg-wa-teal text-white rounded-lg text-sm font-medium hover:bg-wa-tealDark",children:"View Group"})};default:return{icon:"ðŸ“¬",message:"",action:null}}})(),k=function(e){if(!e)return"";const a=new Date,t=e.toDate?e.toDate():new Date(e),r=Math.floor((a-t)/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:r<604800?`${Math.floor(r/86400)}d ago`:`${Math.floor(r/604800)}w ago`}(a.createdAt);return t.jsxs("div",{className:"flex items-start gap-3 p-4 hover:bg-gray-50 dark:hover:bg-wa-dark-hover transition-colors cursor-pointer "+(a.read?"":"bg-blue-50 dark:bg-blue-900/10"),onClick:()=>n(`/profile/${p.id}`),children:[t.jsx("img",{src:p.avatar||`https://ui-avatars.com/api/?name=${p.name}&background=128c7e&color=fff`,alt:p.name,className:"w-12 h-12 rounded-full object-cover shrink-0"}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("div",{className:"flex items-start justify-between gap-2",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsxs("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:[t.jsx("span",{className:"font-semibold",children:p.name})," ",t.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:w.message})]}),t.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1",children:k})]}),t.jsx("span",{className:"text-lg shrink-0",children:w.icon})]}),w.action&&t.jsx("div",{className:"mt-3",onClick:e=>e.stopPropagation(),children:w.action})]}),!a.read&&t.jsx("div",{className:"w-2 h-2 bg-wa-teal rounded-full shrink-0 mt-2"})]})},c=()=>{const r=o(),{currentUser:s}=e(),[c,m]=l.useState([]),[x,u]=l.useState(!0),[g,h]=l.useState(0);l.useEffect(()=>(f(),()=>{g>0&&a.markAllAsRead(null==s?void 0:s.id).catch(e=>{})}),[null==s?void 0:s.id]);const f=async()=>{if(null==s?void 0:s.id){u(!0);try{const e=await a.getUserNotifications(s.id,50);e.success&&(m(e.notifications),h(e.unreadCount))}catch(e){}finally{u(!1)}}},b=()=>{f()};return t.jsxs("div",{className:"flex flex-col pb-20 bg-white dark:bg-wa-dark-bg min-h-full",children:[t.jsxs("div",{className:"hidden md:flex h-[60px] bg-wa-grayBg dark:bg-wa-dark-header items-center gap-3 px-4 shrink-0 border-b border-wa-border dark:border-wa-dark-border text-[#111b21] dark:text-gray-100 transition-colors sticky top-0 z-10",children:[t.jsx("button",{onClick:()=>r(-1),className:"p-2 -ml-2 rounded-full hover:bg-black/10 dark:hover:bg-white/10 transition-colors",children:t.jsx(i,{size:24})}),t.jsx("h2",{className:"text-xl font-medium md:text-lg",children:"Notifications"}),g>0&&t.jsxs("span",{className:"ml-auto text-sm bg-wa-teal/10 text-wa-teal px-2 py-1 rounded-full",children:[g," unread"]})]}),t.jsxs("div",{className:"flex md:hidden items-center justify-between px-4 py-4",children:[t.jsxs("div",{className:"flex items-center gap-4",children:[t.jsx("button",{onClick:()=>r(-1),className:"p-2 -ml-2 hover:bg-gray-100 dark:hover:bg-wa-dark-hover rounded-full transition-colors",children:t.jsx(i,{size:24,className:"text-[#111b21] dark:text-gray-100"})}),t.jsx("h1",{className:"text-xl font-medium text-[#111b21] dark:text-gray-100",children:"Notifications"})]}),g>0&&t.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[g," unread"]})]}),t.jsx("div",{className:"flex-1 overflow-y-auto",children:t.jsx("div",{className:"max-w-3xl mx-auto",children:x?t.jsx("div",{className:"flex items-center justify-center h-64",children:t.jsx("div",{className:"w-12 h-12 border-4 border-wa-teal border-t-transparent rounded-full animate-spin"})}):0===c.length?t.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-center px-4",children:[t.jsx("div",{className:"w-20 h-20 bg-gray-100 dark:bg-wa-dark-hover rounded-full flex items-center justify-center mb-4",children:t.jsx(n,{size:40,className:"text-gray-400"})}),t.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"No notifications yet"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-sm",children:"When someone follows you or requests to follow, you'll see it here"})]}):t.jsx("div",{className:"divide-y divide-gray-200 dark:divide-wa-dark-border",children:c.map(e=>t.jsx(d,{notification:e,onActionTaken:b},e.id))})})})]})};export{c as default};
