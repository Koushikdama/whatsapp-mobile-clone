import{u as e,f as t,a,j as s}from"./index-7VfhOhEA.js";import{u as r,r as l}from"./router-BlRKbG7o.js";import{y as i,m as o,U as n,a2 as c,c as d,X as g}from"./icons-FsuYV2CB.js";import"./react-vendor-Dp0kJvEn.js";import"./lottie-BmTBBIiw.js";import"./chess-Bi0BiJQc.js";const u=()=>{const u=r(),{currentUser:m,pendingRequests:x,acceptRequest:h,rejectRequest:y}=e(),[f,p]=l.useState("incoming"),[w,b]=l.useState([]),[j,v]=l.useState([]),[k,N]=l.useState(!0),[q,C]=l.useState(null),[R,I]=l.useState("");l.useEffect(()=>{U()},[null==m?void 0:m.id]);const U=async()=>{if(null==m?void 0:m.id){N(!0);try{const{success:e,requests:s}=await t.getPendingRequests(m.id);if(e&&s.length>0){const e=await Promise.all(s.map(async e=>{const{user:t}=await a.getUser(e.followerId);return{...e,user:t||{name:"Unknown User",avatar:null,email:""}}}));b(e)}else b([]);const{success:r,requests:l}=await t.getOutgoingRequests(m.id);if(r&&l.length>0){const e=await Promise.all(l.map(async e=>{const{user:t}=await a.getUser(e.followingId);return{...e,user:t||{name:"Unknown User",avatar:null,email:""}}}));v(e)}else v([])}catch(e){}finally{N(!1)}}},F="incoming"===f?w:j,$=F.filter(e=>{var t,a;return null==(a=null==(t=e.user)?void 0:t.name)?void 0:a.toLowerCase().includes(R.toLowerCase())}),S=({request:e,type:a})=>{var r,l,i,o,n;return s.jsx("div",{className:"bg-white dark:bg-wa-dark p-4 rounded-xl shadow-sm hover:shadow-md transition-shadow",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"flex items-center gap-3 flex-1 cursor-pointer",onClick:()=>u(`/profile/${"incoming"===a?e.followerId:e.followingId}`),children:[s.jsx("img",{src:(null==(r=e.user)?void 0:r.avatar)||`https://ui-avatars.com/api/?name=${(null==(l=e.user)?void 0:l.name)||"User"}`,alt:null==(i=e.user)?void 0:i.name,className:"w-12 h-12 rounded-full object-cover bg-gray-200"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h3",{className:"font-medium text-gray-900 dark:text-white truncate",children:(null==(o=e.user)?void 0:o.name)||"Unknown User"}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:(null==(n=e.user)?void 0:n.about)||"Hey there! I am using WhatsApp"})]})]}),s.jsx("div",{className:"flex items-center gap-2 ml-2",children:"incoming"===a?s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:()=>(async e=>{C(e.id);try{(await t.acceptFollowRequest(e.followerId,m.id)).success&&b(t=>t.filter(t=>t.id!==e.id))}catch(a){alert("Failed to accept request. Please try again.")}C(null)})(e),disabled:q===e.id,className:"p-2 bg-wa-teal text-white rounded-lg hover:bg-wa-teal-dark disabled:opacity-50 transition-colors",title:"Accept",children:s.jsx(d,{size:20})}),s.jsx("button",{onClick:()=>(async e=>{C(e.id);try{(await t.rejectFollowRequest(e.followerId,m.id)).success&&b(t=>t.filter(t=>t.id!==e.id))}catch(a){alert("Failed to reject request. Please try again.")}C(null)})(e),disabled:q===e.id,className:"p-2 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 rounded-lg hover:bg-red-100 hover:text-red-500 dark:hover:bg-red-900/30 dark:hover:text-red-400 disabled:opacity-50 transition-colors",title:"Reject",children:s.jsx(g,{size:20})})]}):s.jsx("button",{onClick:()=>(async e=>{C(e.id);try{(await t.cancelFollowRequest(m.id,e.followingId)).success&&v(t=>t.filter(t=>t.id!==e.id))}catch(a){alert("Failed to cancel request. Please try again.")}C(null)})(e),disabled:q===e.id,className:"px-3 py-2 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 disabled:opacity-50 transition-colors text-sm font-medium",children:q===e.id?"Canceling...":"Cancel"})})]})})};return s.jsxs("div",{className:"flex flex-col h-screen bg-gray-50 dark:bg-wa-dark-bg",children:[s.jsxs("div",{className:"bg-white dark:bg-wa-dark border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",children:[s.jsx("button",{onClick:()=>u(-1),className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full transition-colors",children:s.jsx(i,{className:"w-6 h-6 text-gray-600 dark:text-gray-300"})}),s.jsxs("div",{children:[s.jsx("h1",{className:"text-xl font-medium text-gray-800 dark:text-gray-100",children:"Follow Requests"}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"incoming"===f?`${w.length} incoming`:`${j.length} outgoing`})]})]}),s.jsxs("div",{className:"flex border-b border-gray-200 dark:border-gray-700",children:[s.jsxs("button",{onClick:()=>p("incoming"),className:"flex-1 py-3 text-sm font-medium transition-colors relative "+("incoming"===f?"text-wa-teal dark:text-wa-teal":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:["Incoming ",w.length>0&&`(${w.length})`,"incoming"===f&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-wa-teal"})]}),s.jsxs("button",{onClick:()=>p("outgoing"),className:"flex-1 py-3 text-sm font-medium transition-colors relative "+("outgoing"===f?"text-wa-teal dark:text-wa-teal":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300"),children:["Outgoing ",j.length>0&&`(${j.length})`,"outgoing"===f&&s.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-wa-teal"})]})]}),F.length>0&&s.jsxs("div",{className:"p-4 space-y-3",children:[s.jsxs("div",{className:"relative",children:[s.jsx(o,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400",size:18}),s.jsx("input",{type:"text",placeholder:"Search...",value:R,onChange:e=>I(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-gray-800 border-none rounded-lg text-sm text-gray-900 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-wa-teal"})]}),"incoming"===f&&w.length>1&&s.jsxs("div",{className:"flex gap-2",children:[s.jsx("button",{onClick:async()=>{if(confirm(`Accept all ${w.length} follow requests?`)){N(!0);for(const a of w)try{await t.acceptFollowRequest(a.followerId,m.id)}catch(e){}await U()}},className:"flex-1 py-2 px-3 bg-wa-teal text-white rounded-lg text-sm font-medium hover:bg-wa-teal-dark transition-colors",children:"Accept All"}),s.jsx("button",{onClick:async()=>{if(confirm(`Reject all ${w.length} follow requests?`)){N(!0);for(const a of w)try{await t.rejectFollowRequest(a.followerId,m.id)}catch(e){}await U()}},className:"flex-1 py-2 px-3 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg text-sm font-medium hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors",children:"Reject All"})]})]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto p-4",children:k?s.jsx("div",{className:"flex justify-center py-12",children:s.jsx("div",{className:"w-8 h-8 border-2 border-wa-teal border-t-transparent rounded-full animate-spin"})}):0===$.length?s.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:[s.jsx("div",{className:"p-4 bg-gray-100 dark:bg-gray-800 rounded-full mb-3",children:"incoming"===f?s.jsx(n,{className:"w-8 h-8 opacity-50"}):s.jsx(c,{className:"w-8 h-8 opacity-50"})}),s.jsx("p",{className:"text-center font-medium mb-1",children:R?"No requests found":"incoming"===f?"No incoming requests":"No outgoing requests"}),s.jsx("p",{className:"text-sm text-center max-w-xs",children:R?`No requests matching "${R}"`:"incoming"===f?"When someone requests to follow you, their request will appear here":"Your outgoing follow requests will appear here"})]}):s.jsx("div",{className:"space-y-3 max-w-2xl mx-auto",children:$.map(e=>s.jsx(S,{request:e,type:f},e.id))})})]})};export{u as default};
