import{u as e,a,j as r}from"./index-BvqpNl34.js";import{u as s,b as t,r as i}from"./router-BlRKbG7o.js";import{g as l}from"./GroupService-DE6lM_uo.js";import{L as n,a as o,T as c,C as d}from"./UIFeedback-DmX0c331.js";import{y as m,aj as u,m as g,aB as x,ae as p,$ as h,aC as f}from"./icons-DchmmGMJ.js";import"./react-vendor-Dp0kJvEn.js";import"./lottie-BmTBBIiw.js";import"./chess-Bi0BiJQc.js";const y=()=>{const y=s(),{groupId:b}=t(),{chats:v,currentUser:k,users:j}=e(),[w,N]=i.useState(null),[C,T]=i.useState([]),[S,z]=i.useState(""),[A,$]=i.useState(!1),[R,G]=i.useState(!1),[E,D]=i.useState(null),[F,L]=i.useState(!0),[P,B]=i.useState(null),[I,M]=i.useState(!1),[O,U]=i.useState(null);i.useEffect(()=>{H()},[b]),i.useEffect(()=>{if(O){const e=setTimeout(()=>U(null),3e3);return()=>clearTimeout(e)}},[O]);const H=async()=>{try{const e=v.find(e=>e.id===b&&e.isGroup);if(e){N(e);const r=await Promise.all((e.participants||[]).map(async e=>{if(j[e])return j[e];const r=await a.getUser(e);return r.success?r.user:null}));T(r.filter(Boolean));const s=await l.isAdmin(b,null==k?void 0:k.id),t=await l.isOwner(b,null==k?void 0:k.id);$(s),G(t)}}catch(e){}finally{L(!1)}},W=C.filter(e=>e.name.toLowerCase().includes(S.toLowerCase()));return F?r.jsx(n,{fullScreen:!0,message:"Loading participants..."}):r.jsxs("div",{className:"flex flex-col h-screen bg-white dark:bg-wa-dark-bg",children:[r.jsxs("div",{className:"h-[60px] bg-wa-grayBg dark:bg-wa-dark-header flex items-center px-4 border-b border-wa-border dark:border-wa-dark-border shrink-0",children:[r.jsx("button",{onClick:()=>y(-1),className:"p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded-full -ml-2",children:r.jsx(m,{size:24,className:"text-gray-700 dark:text-gray-300"})}),r.jsxs("div",{className:"flex-1 ml-4",children:[r.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"Participants"}),r.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[C.length," members"]})]}),A&&r.jsx("button",{onClick:()=>y(`/group/${b}/add-participants`),className:"p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded-full",children:r.jsx(u,{size:24,className:"text-wa-teal"})})]}),r.jsx("div",{className:"p-4 border-b border-gray-200 dark:border-wa-dark-border",children:r.jsxs("div",{className:"relative",children:[r.jsx(g,{size:20,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),r.jsx("input",{type:"text",placeholder:"Search participants...",value:S,onChange:e=>z(e.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-100 dark:bg-wa-dark-hover rounded-lg outline-none text-gray-900 dark:text-gray-100"})]})}),r.jsxs("div",{className:"flex-1 overflow-y-auto",children:[W.map(e=>{const a=(s=e.id,null==(t=null==w?void 0:w.admins)?void 0:t.includes(s));var s,t;const i=(e=>(null==w?void 0:w.owner)===e)(e.id),n=(A||R)&&e.id!==(null==k?void 0:k.id)&&!i;return r.jsxs("div",{className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-wa-dark-hover transition-colors",children:[r.jsx("img",{src:e.avatar||`https://ui-avatars.com/api/?name=${e.name}&background=128c7e&color=fff`,alt:e.name,className:"w-12 h-12 rounded-full object-cover shrink-0"}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("h3",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:[e.name,e.id===(null==k?void 0:k.id)&&" (You)"]}),i&&r.jsx(x,{size:16,className:"text-yellow-500",fill:"currentColor"}),a&&!i&&r.jsx(p,{size:16,className:"text-wa-teal"})]}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 truncate",children:i?"Group Owner":a?"Group Admin":e.about||"Hey there! I am using WhatsApp."})]}),n&&r.jsx("button",{onClick:()=>D(E===e.id?null:e.id),className:"p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded-full",children:r.jsx(h,{size:20,className:"text-gray-600 dark:text-gray-400"})}),E===e.id&&r.jsxs("div",{className:"absolute right-4 mt-2 bg-white dark:bg-wa-dark-paper rounded-lg shadow-lg border border-gray-200 dark:border-wa-dark-border z-10",children:[!a&&A&&r.jsxs("button",{onClick:()=>(async(e,a)=>{B({title:"Make Admin?",message:`Give ${a} admin privileges? They will be able to manage participants and group settings.`,confirmText:"Make Admin",onConfirm:async()=>{M(!0);try{const r=await l.promoteToAdmin(b,e);r.success?(U({type:"success",message:`${a} is now an admin`}),await H(),D(null)):U({type:"error",message:r.error||"Failed to promote user"})}catch(r){U({type:"error",message:"Error promoting user"})}finally{M(!1),B(null)}}})})(e.id,e.name),className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-wa-dark-hover w-full text-left",children:[r.jsx(p,{size:18,className:"text-wa-teal"}),r.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"Make Admin"})]}),a&&R&&r.jsxs("button",{onClick:()=>(async(e,a)=>{B({title:"Remove Admin?",message:`Remove admin privileges from ${a}? They will become a regular member.`,confirmText:"Remove Admin",confirmDanger:!0,onConfirm:async()=>{M(!0);try{await l.demoteFromAdmin(b,e),U({type:"success",message:`${a} is no longer an admin`}),await H(),D(null)}catch(r){U({type:"error",message:"Error removing admin"})}finally{M(!1),B(null)}}})})(e.id,e.name),className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-wa-dark-hover w-full text-left",children:[r.jsx(p,{size:18,className:"text-gray-500"}),r.jsx("span",{className:"text-gray-900 dark:text-gray-100",children:"Remove as Admin"})]}),(A||R)&&r.jsxs("button",{onClick:()=>((e,a)=>{B({title:"Remove Participant?",message:`Remove ${a} from the group? They can be added back by an admin.`,confirmText:"Remove",confirmDanger:!0,onConfirm:async()=>{M(!0);try{const r=await l.removeParticipant(b,e);r.success?(U({type:"success",message:`${a} removed from group`}),await H(),D(null)):U({type:"error",message:r.error||"Failed to remove participant"})}catch(r){U({type:"error",message:"Error removing participant"})}finally{M(!1),B(null)}}})})(e.id,e.name),className:"flex items-center gap-3 px-4 py-3 hover:bg-gray-50 dark:hover:bg-wa-dark-hover w-full text-left border-t border-gray-200 dark:border-wa-dark-border",children:[r.jsx(f,{size:18,className:"text-red-500"}),r.jsx("span",{className:"text-red-500",children:"Remove from Group"})]})]})]},e.id)}),0===W.length&&r.jsx(o,{icon:g,title:"No participants found",description:S?`No results for "${S}"`:"This group has no participants"})]}),E&&r.jsx("div",{className:"fixed inset-0 z-0",onClick:()=>D(null)}),O&&r.jsx(c,{type:O.type,message:O.message,onClose:()=>U(null)}),P&&r.jsx(d,{isOpen:!0,title:P.title,message:P.message,confirmText:P.confirmText,cancelText:"Cancel",confirmDanger:P.confirmDanger,loading:I,onConfirm:P.onConfirm,onClose:()=>B(null)})]})};export{y as default};
