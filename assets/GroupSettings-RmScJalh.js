import{u as e,j as s}from"./index-7VfhOhEA.js";import{u as a,b as r,r as t}from"./router-BlRKbG7o.js";import{g as l}from"./GroupService-BxMnZ1G7.js";import{L as i,E as o,T as n,C as c}from"./UIFeedback-BgTv84Bl.js";import{y as d,ad as u,aG as g,D as m,ah as x,I as p,L as b,aF as h,ak as f,ar as y,T as w}from"./icons-FsuYV2CB.js";import"./react-vendor-Dp0kJvEn.js";import"./lottie-BmTBBIiw.js";import"./chess-Bi0BiJQc.js";const k=()=>{var k,N;const C=a(),{groupId:G}=r(),{chats:T,currentUser:S}=e(),[D,A]=t.useState(null),[L,M]=t.useState(!1),[E,U]=t.useState(!1),[F,P]=t.useState(!0),[z,O]=t.useState(null),[B,H]=t.useState(!0),[I,$]=t.useState(null),[V,Q]=t.useState(!1),[R,Y]=t.useState(null);t.useEffect(()=>{q()},[G]),t.useEffect(()=>{if(R){const e=setTimeout(()=>Y(null),3e3);return()=>clearTimeout(e)}},[R]);const q=async()=>{var e;P(!0),O(null);try{const s=T.find(e=>e.id===G&&e.isGroup);if(s){A(s);const a=await l.isAdmin(G,null==S?void 0:S.id),r=await l.isOwner(G,null==S?void 0:S.id);M(a),U(r),H((null==(e=s.settings)?void 0:e.showHistoryToNewMembers)??!0)}else O("Group not found")}catch(s){O("Failed to load group settings")}finally{P(!1)}},J=async()=>{var e;const s=(null==(e=null==D?void 0:D.settings)?void 0:e.muteUntil)&&new Date(D.settings.muteUntil)>new Date;try{const e=s?null:288e5;await l.muteGroup(G,e),Y({type:"success",message:s?"Notifications unmuted":"Notifications muted for 8 hours"}),q()}catch(a){Y({type:"error",message:"Error updating mute status"})}};if(F)return s.jsx(i,{fullScreen:!0,message:"Loading group settings..."});if(z||!D)return s.jsxs("div",{className:"flex flex-col h-screen bg-white dark:bg-wa-dark-bg",children:[s.jsxs("div",{className:"h-[60px] bg-wa-grayBg dark:bg-wa-dark-header flex items-center px-4 border-b border-wa-border dark:border-wa-dark-border",children:[s.jsx("button",{onClick:()=>C(-1),className:"p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded-full -ml-2",children:s.jsx(d,{size:24,className:"text-gray-700 dark:text-gray-300"})}),s.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 ml-4",children:"Group Settings"})]}),s.jsx(o,{message:z||"Group not found",onRetry:q}),s.jsx("div",{className:"flex flex-col items-center justify-center flex-1 gap-4",children:s.jsx("button",{onClick:()=>C("/chats"),className:"px-4 py-2 bg-wa-teal text-white rounded-lg hover:bg-wa-tealDark transition-colors",children:"Back to Chats"})})]});const K=(null==(k=null==D?void 0:D.settings)?void 0:k.muteUntil)&&new Date(D.settings.muteUntil)>new Date;return s.jsxs("div",{className:"flex flex-col h-screen bg-white dark:bg-wa-dark-bg",children:[s.jsxs("div",{className:"h-[60px] bg-wa-grayBg dark:bg-wa-dark-header flex items-center px-4 border-b border-wa-border dark:border-wa-dark-border shrink-0",children:[s.jsx("button",{onClick:()=>C(-1),className:"p-2 hover:bg-black/5 dark:hover:bg-white/10 rounded-full -ml-2",children:s.jsx(d,{size:24,className:"text-gray-700 dark:text-gray-300"})}),s.jsx("h1",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100 ml-4",children:"Group Settings"})]}),s.jsxs("div",{className:"flex-1 overflow-y-auto",children:[s.jsxs("div",{className:"bg-white dark:bg-wa-dark-paper p-4 border-b-8 border-gray-100 dark:border-wa-dark-bg",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsx("img",{src:D.avatar||"https://ui-avatars.com/api/?name=Group&background=128c7e&color=fff",alt:D.groupName,className:"w-16 h-16 rounded-full object-cover"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 truncate",children:D.groupName}),s.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[(null==(N=D.participants)?void 0:N.length)||0," participants"]}),(L||E)&&s.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 bg-wa-teal/10 text-wa-teal text-xs rounded-full",children:E?"Owner":"Admin"})]})]}),D.description&&s.jsx("p",{className:"mt-3 text-sm text-gray-600 dark:text-gray-400",children:D.description})]}),s.jsxs("div",{className:"bg-white dark:bg-wa-dark-paper",children:[s.jsxs(j,{title:"Quick Actions",children:[s.jsx(v,{icon:K?u:g,label:K?"Unmute":"Mute",onClick:J}),s.jsx(v,{icon:m,label:"Manage Participants",onClick:()=>C(`/group/${G}/participants`),showArrow:!0}),L&&s.jsx(v,{icon:x,label:"Permissions",onClick:()=>C(`/group/${G}/permissions`),showArrow:!0})]}),s.jsx(j,{title:"Media & Files",children:s.jsx(v,{icon:p,label:"Media, Links & Docs",onClick:()=>C(`/chat/${G}/info`),showArrow:!0})}),L&&s.jsxs(j,{title:"Privacy & Notifications",children:[s.jsx(v,{icon:"private"===(null==D?void 0:D.privacy)?b:h,label:"Group Privacy",sublabel:"private"===(null==D?void 0:D.privacy)?"Private":"Public",onClick:()=>{}}),s.jsx(v,{icon:K?g:u,label:K?"Notifications Muted":"Notifications Active",onClick:J}),E&&s.jsx(v,{icon:f,label:"Show History to New Members",sublabel:B?"New members can see past messages":"New members only see messages after joining",onClick:async()=>{const e=!B;Q(!0);try{const s=await l.updateGroupSettings(G,{showHistoryToNewMembers:e});s.success?(H(e),Y({type:"success",message:e?"New members can see all message history":"New members will only see messages after joining"}),q()):Y({type:"error",message:s.error||"Failed to update setting"})}catch(s){Y({type:"error",message:"Error updating setting"})}finally{Q(!1)}},hasToggle:!0,toggleValue:B})]}),s.jsxs(j,{title:"Group Actions",children:[s.jsx(v,{icon:y,label:"Leave Group",onClick:()=>{E?Y({type:"error",message:"Owner must transfer ownership before leaving"}):$({title:"Leave Group?",message:"Are you sure you want to leave this group? You can be added back by an admin.",confirmText:"Leave",confirmDanger:!0,onConfirm:async()=>{Q(!0);try{const e=await l.leaveGroup(G,null==S?void 0:S.id);e.success?(Y({type:"success",message:"Left group successfully"}),setTimeout(()=>C("/chats"),1e3)):Y({type:"error",message:e.error||"Failed to leave group"})}catch(e){Y({type:"error",message:"Error leaving group"})}finally{Q(!1),$(null)}}})},danger:!0}),E&&s.jsx(v,{icon:w,label:"Delete Group",onClick:()=>{$({title:"Delete Group?",message:"This will permanently delete the group for all members. This action cannot be undone.",confirmText:"Delete",confirmDanger:!0,onConfirm:async()=>{Q(!0);try{await l.deleteGroup(G),Y({type:"success",message:"Group deleted successfully"}),setTimeout(()=>C("/chats"),1e3)}catch(e){Y({type:"error",message:"Error deleting group"})}finally{Q(!1),$(null)}}})},danger:!0})]})]})]}),R&&s.jsx(n,{type:R.type,message:R.message,onClose:()=>Y(null)}),I&&s.jsx(c,{isOpen:!0,title:I.title,message:I.message,confirmText:I.confirmText,cancelText:"Cancel",confirmDanger:I.confirmDanger,loading:V,onConfirm:I.onConfirm,onClose:()=>$(null)})]})},j=({title:e,children:a})=>s.jsxs("div",{className:"border-b-8 border-gray-100 dark:border-wa-dark-bg",children:[s.jsx("div",{className:"px-4 py-2",children:s.jsx("h3",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:e})}),s.jsx("div",{children:a})]}),v=({icon:e,label:a,sublabel:r,onClick:t,danger:l,showArrow:i,hasToggle:o,toggleValue:n})=>s.jsxs("button",{onClick:t,className:"w-full flex items-center gap-4 px-4 py-3 hover:bg-gray-50 dark:hover:bg-wa-dark-hover transition-colors",children:[s.jsx(e,{size:22,className:l?"text-red-500":"text-gray-600 dark:text-gray-400"}),s.jsxs("div",{className:"flex-1 text-left",children:[s.jsx("span",{className:"block "+(l?"text-red-500":"text-gray-900 dark:text-gray-100"),children:a}),r&&s.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:r})]}),o&&s.jsx("div",{className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors "+(n?"bg-wa-teal":"bg-gray-300 dark:bg-gray-600"),children:s.jsx("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform "+(n?"translate-x-6":"translate-x-1")})}),i&&s.jsx(d,{size:20,className:"text-gray-400 rotate-180"})]});export{k as default};
